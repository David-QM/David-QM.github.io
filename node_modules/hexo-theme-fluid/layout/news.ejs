<%
page.subtitle = theme[page.title].subtitle
page.banner_img = theme[page.title].banner_img
page.banner_img_height = theme[page.title].banner_img_height
page.banner_mask_alpha = theme[page.title].banner_mask_alpha
var orderBy = theme[page.title].order_by || 'name'
var curCats = site.categories.find({ name: page.subtitle }).sort(orderBy).filter(cat => cat.length)

var params = {
  orderBy: orderBy,
  postLimit  : theme.category.post_limit,
  postOrderBy: theme.category.post_order_by || config.index_generator.order_by
}
%>


<!-- recurrent function -->
<% function render_news(curCats,result,orderBy) {%>
  <% curCats.forEach((cat) => { %>
    <% var subCats = site.categories.find({ parent: cat._id }).sort(orderBy).filter(cat => cat.length) %>

    <% if (subCats.length > 0) { %>
      <% result.concat(render_news(subCats,result,orderBy)) %>
      <% } else { %>
      <% var posts = cat.posts.sort(orderBy) %>
      <% for (var idx = 0; idx < posts.length; idx++) { %>   
        <% result.push(posts.data[idx]) %>
      <% } %>

    <% } %>

  <% }) %>
  
  <% return result %>

<% } %>


<!-- print function -->
<% var result = [] %>
<% var news_posts = render_news(curCats,result,orderBy) %>

<%
let sorted_posts = news_posts.slice().sort(function(a, b) {
  let dateA = new Date(a.date);
  let dateB = new Date(b.date);
  return dateB - dateA; 
});
%>

<div class="list-group">
  <% for (var idx = 0; idx < sorted_posts.length; idx++) { %>
    <% var post = sorted_posts[idx] %>
    <a href="<%= url_for(post.path) %>" class="list-group-item list-group-item-action" >
      <div class="list-group-item-title">
        [<%= date(post.date, "DD-MM-YYYY") %>]&nbsp;&nbsp;<br><b style="word-wrap: break-word; white-space: pre-wrap;"><%= post.description %></b>
      </div>
    </a>
  <% } %>

</div>


<%- partial('_partials/paginator') %>


